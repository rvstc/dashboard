{"ast":null,"code":"import _classCallCheck from \"/Users/williamsnathan/src/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/williamsnathan/src/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport * as types from './types';\nimport { MEMBER_DATA_LOADED } from 'services/gapi/types';\nimport { logUser, lookupResults } from './actions';\nimport { loadData } from 'services/gapi/actions';\n\nvar UserMiddleware =\n/*#__PURE__*/\nfunction () {\n  function UserMiddleware() {\n    var _this = this;\n\n    _classCallCheck(this, UserMiddleware);\n\n    return function (store) {\n      _this.store = store;\n      return _this.muxer();\n    };\n  }\n\n  _createClass(UserMiddleware, [{\n    key: \"muxer\",\n    value: function muxer() {\n      var _this2 = this;\n\n      return function (next) {\n        return function (action) {\n          if (action.type === types.LOOKUP_USER) {\n            _this2.lookupUser(action.payload.query);\n          } else if (action.type === MEMBER_DATA_LOADED) {\n            _this2.updateMemberData(action.payload);\n          }\n\n          return next(action);\n        };\n      };\n    }\n  }, {\n    key: \"updateMemberData\",\n    value: function updateMemberData(data) {\n      this.members = data.slice(1).reduce(function (list, row) {\n        list.push({\n          id: row[0],\n          name: row[1]\n        });\n        return list;\n      }, []);\n      this.membersById = this.members.reduce(function (map, member) {\n        map[member.id] = member;\n        return map;\n      }, {});\n    }\n  }, {\n    key: \"lookupUser\",\n    value: function lookupUser(query) {\n      var results = [];\n\n      for (var i = 0; i < this.members.length; i++) {\n        var member = this.members[i];\n\n        if (member.id == query || member.name.includes(query)) {\n          results.push(member);\n        }\n      }\n\n      if (results.length > 1) {\n        this.store.dispatch(lookupResults(results));\n      } else if (results.length == 1) {\n        this.store.dispatch(logUser(results[0].name));\n      } else {// lookup failed...\n      }\n    }\n  }]);\n\n  return UserMiddleware;\n}();\n\nexport { UserMiddleware as default };","map":{"version":3,"sources":["/Users/williamsnathan/src/dashboard/src/services/user/middleware.js"],"names":["types","MEMBER_DATA_LOADED","logUser","lookupResults","loadData","UserMiddleware","store","muxer","next","action","type","LOOKUP_USER","lookupUser","payload","query","updateMemberData","data","members","slice","reduce","list","row","push","id","name","membersById","map","member","results","i","length","includes","dispatch"],"mappings":";;AAAA,OAAO,KAAKA,KAAZ,MAAuB,SAAvB;AACA,SAASC,kBAAT,QAAmC,qBAAnC;AACA,SAASC,OAAT,EAAkBC,aAAlB,QAAuC,WAAvC;AACA,SAASC,QAAT,QAAyB,uBAAzB;;IAGqBC,c;;;AAEnB,4BAAc;AAAA;;AAAA;;AACZ,WAAO,UAAAC,KAAK,EAAI;AACd,MAAA,KAAI,CAACA,KAAL,GAAaA,KAAb;AACA,aAAO,KAAI,CAACC,KAAL,EAAP;AACD,KAHD;AAID;;;;4BAEO;AAAA;;AACN,aAAO,UAAAC,IAAI;AAAA,eAAI,UAAAC,MAAM,EAAI;AACvB,cAAIA,MAAM,CAACC,IAAP,KAAgBV,KAAK,CAACW,WAA1B,EAAuC;AACrC,YAAA,MAAI,CAACC,UAAL,CAAgBH,MAAM,CAACI,OAAP,CAAeC,KAA/B;AACD,WAFD,MAEO,IAAIL,MAAM,CAACC,IAAP,KAAgBT,kBAApB,EAAwC;AAC7C,YAAA,MAAI,CAACc,gBAAL,CAAsBN,MAAM,CAACI,OAA7B;AACD;;AACD,iBAAOL,IAAI,CAACC,MAAD,CAAX;AACD,SAPU;AAAA,OAAX;AAQD;;;qCAEgBO,I,EAAM;AACrB,WAAKC,OAAL,GAAeD,IAAI,CAACE,KAAL,CAAW,CAAX,EAAcC,MAAd,CAAqB,UAAUC,IAAV,EAAgBC,GAAhB,EAAqB;AACvDD,QAAAA,IAAI,CAACE,IAAL,CAAU;AACRC,UAAAA,EAAE,EAAEF,GAAG,CAAC,CAAD,CADC;AAERG,UAAAA,IAAI,EAAEH,GAAG,CAAC,CAAD;AAFD,SAAV;AAIA,eAAOD,IAAP;AACD,OANc,EAMZ,EANY,CAAf;AAOA,WAAKK,WAAL,GAAmB,KAAKR,OAAL,CAAaE,MAAb,CAAoB,UAAUO,GAAV,EAAeC,MAAf,EAAuB;AAC5DD,QAAAA,GAAG,CAACC,MAAM,CAACJ,EAAR,CAAH,GAAiBI,MAAjB;AACA,eAAOD,GAAP;AACD,OAHkB,EAGhB,EAHgB,CAAnB;AAID;;;+BAEUZ,K,EAAO;AAChB,UAAMc,OAAO,GAAG,EAAhB;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKZ,OAAL,CAAaa,MAAjC,EAAyCD,CAAC,EAA1C,EAA8C;AAC5C,YAAIF,MAAM,GAAG,KAAKV,OAAL,CAAaY,CAAb,CAAb;;AACA,YAAIF,MAAM,CAACJ,EAAP,IAAaT,KAAb,IAAsBa,MAAM,CAACH,IAAP,CAAYO,QAAZ,CAAqBjB,KAArB,CAA1B,EAAuD;AACrDc,UAAAA,OAAO,CAACN,IAAR,CAAaK,MAAb;AACD;AACF;;AAED,UAAIC,OAAO,CAACE,MAAR,GAAiB,CAArB,EAAwB;AACtB,aAAKxB,KAAL,CAAW0B,QAAX,CAAoB7B,aAAa,CAACyB,OAAD,CAAjC;AACD,OAFD,MAEO,IAAIA,OAAO,CAACE,MAAR,IAAkB,CAAtB,EAAyB;AAC9B,aAAKxB,KAAL,CAAW0B,QAAX,CAAoB9B,OAAO,CAAC0B,OAAO,CAAC,CAAD,CAAP,CAAWJ,IAAZ,CAA3B;AACD,OAFM,MAEA,CACL;AACD;AACF;;;;;;SAnDkBnB,c","sourcesContent":["import * as types from './types';\nimport { MEMBER_DATA_LOADED } from 'services/gapi/types';\nimport { logUser, lookupResults } from './actions';\nimport { loadData } from 'services/gapi/actions';\n\n\nexport default class UserMiddleware {\n\n  constructor() {\n    return store => {\n      this.store = store;\n      return this.muxer();\n    };\n  }\n\n  muxer() {\n    return next => action => {\n      if (action.type === types.LOOKUP_USER) {\n        this.lookupUser(action.payload.query);\n      } else if (action.type === MEMBER_DATA_LOADED) {\n        this.updateMemberData(action.payload);\n      }\n      return next(action);\n    };\n  }\n\n  updateMemberData(data) {\n    this.members = data.slice(1).reduce(function (list, row) {\n      list.push({\n        id: row[0],\n        name: row[1]\n      });\n      return list;\n    }, []);\n    this.membersById = this.members.reduce(function (map, member) {\n      map[member.id] = member;\n      return map;\n    }, {});\n  }\n\n  lookupUser(query) {\n    const results = [];\n\n    for (let i = 0; i < this.members.length; i++) {\n      let member = this.members[i];\n      if (member.id == query || member.name.includes(query)) {\n        results.push(member);\n      }\n    }\n\n    if (results.length > 1) {\n      this.store.dispatch(lookupResults(results));\n    } else if (results.length == 1) {\n      this.store.dispatch(logUser(results[0].name));\n    } else {\n      // lookup failed...\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}