{"ast":null,"code":"import _classCallCheck from \"/Users/williamsnathan/src/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/williamsnathan/src/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport * as types from './types';\nimport { gapiUpdateStatus, memberDataLoaded } from './actions';\nvar API_KEY = 'AIzaSyBCvgn0n9lJ20sDK6jVG-92Yedf1foqjgE';\nvar CLIENT_ID = '617186283105-5e603j6qc477f5q603nf8kef6s34aeov.apps.googleusercontent.com';\nvar DISCOVERY_URL = 'https://sheets.googleapis.com/$discovery/rest?version=v4';\nvar SCOPE = 'https://www.googleapis.com/auth/spreadsheets';\nvar SPREADSHEET_ID = '13bsAu7wG39q0khrefawv5jbgGAz9aKSOMvVfbqsmSWU';\nvar MEMBERS_SHEET_NAME = 'Members';\nvar GAPI_SCRIPT_ID = 'gapi-script';\nvar MEMBER_DATA_REFRESH_INTERVAL = 5 * 1000 * 1000;\n\nvar GapiMiddleware =\n/*#__PURE__*/\nfunction () {\n  function GapiMiddleware() {\n    var _this = this;\n\n    _classCallCheck(this, GapiMiddleware);\n\n    if (!document.getElementById(GAPI_SCRIPT_ID)) {\n      this.loadGapi();\n    }\n\n    return function (store) {\n      _this.store = store;\n      return _this.muxer();\n    };\n  }\n\n  _createClass(GapiMiddleware, [{\n    key: \"muxer\",\n    value: function muxer() {\n      var _this2 = this;\n\n      return function (next) {\n        return function (action) {\n          if (action.type === types.GAPI_TOGGLE_AUTH) {\n            _this2.toggleAuth();\n          } else if (action.type === types.GAPI_REAUTH) {\n            _this2.reauth();\n          } else if (action.type === types.GAPI_REVOKE) {\n            _this2.revokeAccess();\n          }\n\n          return next(action);\n        };\n      };\n    }\n    /** Injects the Google API script into the DOM. */\n\n  }, {\n    key: \"loadGapi\",\n    value: function loadGapi() {\n      var _this3 = this;\n\n      var script = document.createElement('script');\n      script.id = GAPI_SCRIPT_ID;\n      script.src = 'https://apis.google.com/js/api.js';\n\n      script.onload = function () {\n        script.onload = function () {};\n\n        window.gapi.load('client', _this3.initClient.bind(_this3));\n      };\n\n      document.body.appendChild(script);\n    }\n    /** Initializes the GoogleAuth client using the app info. */\n\n  }, {\n    key: \"initClient\",\n    value: function initClient() {\n      window.gapi.client.init({\n        'apiKey': API_KEY,\n        'clientId': CLIENT_ID,\n        'discoveryDocs': [DISCOVERY_URL],\n        'scope': SCOPE\n      }).then(function () {\n        this.GoogleAuth = window.gapi.auth2.getAuthInstance();\n        this.GoogleAuth.isSignedIn.listen(this.handleStatusUpdate.bind(this));\n        this.handleStatusUpdate(this.GoogleAuth.isSignedIn.get());\n      }.bind(this));\n    }\n    /** Listener called when user signin status changes. */\n\n  }, {\n    key: \"handleStatusUpdate\",\n    value: function handleStatusUpdate(isSignedIn) {\n      var isAuthorized = false;\n      var user = {};\n      this.GoogleUser = this.GoogleAuth.currentUser.get();\n\n      if (isSignedIn) {\n        isAuthorized = this.GoogleUser.hasGrantedScopes(SCOPE);\n        var basicProfile = this.GoogleUser.getBasicProfile();\n        user = {\n          id: basicProfile.getId(),\n          name: basicProfile.getName(),\n          givenName: basicProfile.getGivenName(),\n          familyName: basicProfile.getFamilyName(),\n          imageUrl: basicProfile.getImageUrl(),\n          email: basicProfile.getEmail()\n        };\n      }\n\n      if (this.loadMemberDataInterval) {\n        clearInterval(this.loadMemberDataInterval);\n      }\n\n      if (isAuthorized) {\n        this.loadMemberData();\n        this.loadMemberDataInterval = setInterval(this.loadMemberData.bind(this), MEMBER_DATA_REFRESH_INTERVAL);\n      }\n\n      this.store.dispatch(gapiUpdateStatus(isSignedIn, isAuthorized, user));\n    }\n  }, {\n    key: \"toggleAuth\",\n    value: function toggleAuth() {\n      if (this.GoogleAuth.isSignedIn.get()) {\n        this.GoogleAuth.signOut();\n      } else {\n        this.GoogleAuth.signIn();\n      }\n    }\n  }, {\n    key: \"reauth\",\n    value: function reauth() {\n      this.GoogleUser.grant({\n        scope: SCOPE\n      });\n    }\n  }, {\n    key: \"revokeAccess\",\n    value: function revokeAccess() {\n      this.GoogleAuth.disconnect();\n    }\n  }, {\n    key: \"loadMemberData\",\n    value: function loadMemberData() {\n      var _this4 = this;\n\n      var spreadsheetId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : SPREADSHEET_ID;\n      var range = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : MEMBERS_SHEET_NAME;\n      window.gapi.client.sheets.spreadsheets.values.get({\n        spreadsheetId: spreadsheetId,\n        range: range\n      }).then(function (response) {\n        _this4.store.dispatch(memberDataLoaded(response.result.values));\n      });\n    }\n  }]);\n\n  return GapiMiddleware;\n}();\n\nexport { GapiMiddleware as default };","map":{"version":3,"sources":["/Users/williamsnathan/src/dashboard/src/services/gapi/middleware.js"],"names":["types","gapiUpdateStatus","memberDataLoaded","API_KEY","CLIENT_ID","DISCOVERY_URL","SCOPE","SPREADSHEET_ID","MEMBERS_SHEET_NAME","GAPI_SCRIPT_ID","MEMBER_DATA_REFRESH_INTERVAL","GapiMiddleware","document","getElementById","loadGapi","store","muxer","next","action","type","GAPI_TOGGLE_AUTH","toggleAuth","GAPI_REAUTH","reauth","GAPI_REVOKE","revokeAccess","script","createElement","id","src","onload","window","gapi","load","initClient","bind","body","appendChild","client","init","then","GoogleAuth","auth2","getAuthInstance","isSignedIn","listen","handleStatusUpdate","get","isAuthorized","user","GoogleUser","currentUser","hasGrantedScopes","basicProfile","getBasicProfile","getId","name","getName","givenName","getGivenName","familyName","getFamilyName","imageUrl","getImageUrl","email","getEmail","loadMemberDataInterval","clearInterval","loadMemberData","setInterval","dispatch","signOut","signIn","grant","scope","disconnect","spreadsheetId","range","sheets","spreadsheets","values","response","result"],"mappings":"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","sourcesContent":["import * as types from './types';\nimport { gapiUpdateStatus, memberDataLoaded } from './actions';\n\n\nconst API_KEY = 'AIzaSyBCvgn0n9lJ20sDK6jVG-92Yedf1foqjgE';\nconst CLIENT_ID = '617186283105-5e603j6qc477f5q603nf8kef6s34aeov.apps.googleusercontent.com';\nconst DISCOVERY_URL = 'https://sheets.googleapis.com/$discovery/rest?version=v4';\nconst SCOPE = 'https://www.googleapis.com/auth/spreadsheets';\n\nconst SPREADSHEET_ID = '13bsAu7wG39q0khrefawv5jbgGAz9aKSOMvVfbqsmSWU';\nconst MEMBERS_SHEET_NAME = 'Members';\n\nconst GAPI_SCRIPT_ID = 'gapi-script';\nconst MEMBER_DATA_REFRESH_INTERVAL = 5 * 1000 * 1000;\n\n\nexport default class GapiMiddleware {\n\n  constructor() {\n    if (!document.getElementById(GAPI_SCRIPT_ID)) {\n      this.loadGapi();\n    }\n    return store => {\n      this.store = store;\n      return this.muxer();\n    };\n  }\n\n  muxer() {\n    return next => action => {\n      if (action.type === types.GAPI_TOGGLE_AUTH) {\n        this.toggleAuth();\n      } else if (action.type === types.GAPI_REAUTH) {\n        this.reauth();\n      } else if (action.type === types.GAPI_REVOKE) {\n        this.revokeAccess();\n      }\n      return next(action);\n    };\n  }\n\n  /** Injects the Google API script into the DOM. */\n  loadGapi() {\n    const script = document.createElement('script');\n    script.id = GAPI_SCRIPT_ID;\n    script.src = 'https://apis.google.com/js/api.js';\n\n    script.onload = () => {\n      script.onload = () => { };\n      window.gapi.load('client', this.initClient.bind(this));\n    };\n\n    document.body.appendChild(script);\n  }\n\n  /** Initializes the GoogleAuth client using the app info. */\n  initClient() {\n    window.gapi.client.init({\n      'apiKey': API_KEY,\n      'clientId': CLIENT_ID,\n      'discoveryDocs': [DISCOVERY_URL],\n      'scope': SCOPE,\n    }).then(function () {\n      this.GoogleAuth = window.gapi.auth2.getAuthInstance();\n      this.GoogleAuth.isSignedIn.listen(this.handleStatusUpdate.bind(this));\n      this.handleStatusUpdate(this.GoogleAuth.isSignedIn.get());\n    }.bind(this));\n  }\n\n  /** Listener called when user signin status changes. */\n  handleStatusUpdate(isSignedIn) {\n    let isAuthorized = false;\n    let user = {};\n\n    this.GoogleUser = this.GoogleAuth.currentUser.get();\n    if (isSignedIn) {\n      isAuthorized = this.GoogleUser.hasGrantedScopes(SCOPE);\n      const basicProfile = this.GoogleUser.getBasicProfile();\n      user = {\n        id: basicProfile.getId(),\n        name: basicProfile.getName(),\n        givenName: basicProfile.getGivenName(),\n        familyName: basicProfile.getFamilyName(),\n        imageUrl: basicProfile.getImageUrl(),\n        email: basicProfile.getEmail(),\n      };\n    }\n\n    if (this.loadMemberDataInterval) {\n      clearInterval(this.loadMemberDataInterval);\n    }\n\n    if (isAuthorized) {\n      this.loadMemberData();\n      this.loadMemberDataInterval = setInterval(\n        this.loadMemberData.bind(this), MEMBER_DATA_REFRESH_INTERVAL);\n    }\n\n    this.store.dispatch(gapiUpdateStatus(isSignedIn, isAuthorized, user));\n  }\n\n  toggleAuth() {\n    if (this.GoogleAuth.isSignedIn.get()) {\n      this.GoogleAuth.signOut();\n    } else {\n      this.GoogleAuth.signIn();\n    }\n  }\n\n  reauth() {\n    this.GoogleUser.grant({ scope: SCOPE });\n  }\n\n  revokeAccess() {\n    this.GoogleAuth.disconnect();\n  }\n\n  loadMemberData(spreadsheetId = SPREADSHEET_ID, range = MEMBERS_SHEET_NAME) {\n    window.gapi.client.sheets.spreadsheets.values\n      .get({ spreadsheetId, range })\n      .then((response) => {\n        this.store.dispatch(memberDataLoaded(response.result.values));\n      });\n  }\n}\n\n\n"]},"metadata":{},"sourceType":"module"}